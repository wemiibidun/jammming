{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _path = _interopRequireDefault(require(\"path\"));\n\nvar _fs = require(\"fs\");\n\nvar _child_process = require(\"child_process\");\n\nvar _helperPluginUtils = require(\"@babel/helper-plugin-utils\");\n\nvar _istanbulLibInstrument = require(\"istanbul-lib-instrument\");\n\nvar _testExclude = _interopRequireDefault(require(\"test-exclude\"));\n\nvar _schema = _interopRequireDefault(require(\"@istanbuljs/schema\"));\n\nfunction _interopRequireDefault(obj) {\n  return obj && obj.__esModule ? obj : {\n    default: obj\n  };\n}\n\nfunction getRealpath(n) {\n  try {\n    return (0, _fs.realpathSync)(n) ||\n    /* istanbul ignore next */\n    n;\n  } catch (e) {\n    /* istanbul ignore next */\n    return n;\n  }\n}\n\nconst memoize = new Map();\n/* istanbul ignore next */\n\nconst memosep = _path.default.sep === '/' ? ':' : ';';\n\nfunction loadNycConfig(cwd, opts) {\n  let memokey = cwd;\n  const args = [_path.default.resolve(__dirname, 'load-nyc-config-sync.js'), cwd];\n\n  if ('nycrcPath' in opts) {\n    args.push(opts.nycrcPath);\n    memokey += memosep + opts.nycrcPath;\n  }\n  /* execFileSync is expensive, avoid it if possible! */\n\n\n  if (memoize.has(memokey)) {\n    return memoize.get(memokey);\n  }\n\n  const result = JSON.parse((0, _child_process.execFileSync)(process.execPath, args));\n  const error = result['load-nyc-config-sync-error'];\n\n  if (error) {\n    throw new Error(error);\n  }\n\n  const config = { ..._schema.default.defaults.babelPluginIstanbul,\n    cwd,\n    ...result\n  };\n  memoize.set(memokey, config);\n  return config;\n}\n\nfunction findConfig(opts) {\n  const cwd = getRealpath(opts.cwd || process.env.NYC_CWD ||\n  /* istanbul ignore next */\n  process.cwd());\n  const keys = Object.keys(opts);\n  const ignored = Object.keys(opts).filter(s => s === 'nycrcPath' || s === 'cwd');\n\n  if (keys.length > ignored.length) {\n    // explicitly configuring options in babel\n    // takes precedence.\n    return { ..._schema.default.defaults.babelPluginIstanbul,\n      cwd,\n      ...opts\n    };\n  }\n\n  if (ignored.length === 0 && process.env.NYC_CONFIG) {\n    // defaults were already applied by nyc\n    return JSON.parse(process.env.NYC_CONFIG);\n  }\n\n  return loadNycConfig(cwd, opts);\n}\n\nfunction makeShouldSkip() {\n  let exclude;\n  return function shouldSkip(file, nycConfig) {\n    if (!exclude || exclude.cwd !== nycConfig.cwd) {\n      exclude = new _testExclude.default({\n        cwd: nycConfig.cwd,\n        include: nycConfig.include,\n        exclude: nycConfig.exclude,\n        extension: nycConfig.extension,\n        // Make sure this is true unless explicitly set to `false`. `undefined` is still `true`.\n        excludeNodeModules: nycConfig.excludeNodeModules !== false\n      });\n    }\n\n    return !exclude.shouldInstrument(file);\n  };\n}\n\nvar _default = (0, _helperPluginUtils.declare)(api => {\n  api.assertVersion(7);\n  const shouldSkip = makeShouldSkip();\n  const t = api.types;\n  return {\n    visitor: {\n      Program: {\n        enter(path) {\n          this.__dv__ = null;\n          this.nycConfig = findConfig(this.opts);\n          const realPath = getRealpath(this.file.opts.filename);\n\n          if (shouldSkip(realPath, this.nycConfig)) {\n            return;\n          }\n\n          let {\n            inputSourceMap\n          } = this.opts;\n\n          if (this.opts.useInlineSourceMaps !== false) {\n            if (!inputSourceMap && this.file.inputMap) {\n              inputSourceMap = this.file.inputMap.sourcemap;\n            }\n          }\n\n          const visitorOptions = {};\n          Object.entries(_schema.default.defaults.instrumentVisitor).forEach(([name, defaultValue]) => {\n            if (name in this.nycConfig) {\n              visitorOptions[name] = this.nycConfig[name];\n            } else {\n              visitorOptions[name] = _schema.default.defaults.instrumentVisitor[name];\n            }\n          });\n          this.__dv__ = (0, _istanbulLibInstrument.programVisitor)(t, realPath, { ...visitorOptions,\n            inputSourceMap\n          });\n\n          this.__dv__.enter(path);\n        },\n\n        exit(path) {\n          if (!this.__dv__) {\n            return;\n          }\n\n          const result = this.__dv__.exit(path);\n\n          if (this.opts.onCover) {\n            this.opts.onCover(getRealpath(this.file.opts.filename), result.fileCoverage);\n          }\n        }\n\n      }\n    }\n  };\n});\n\nexports.default = _default;","map":{"version":3,"sources":["/Users/wemi/jammming/node_modules/babel-plugin-istanbul/lib/index.js"],"names":["Object","defineProperty","exports","value","default","_path","_interopRequireDefault","require","_fs","_child_process","_helperPluginUtils","_istanbulLibInstrument","_testExclude","_schema","obj","__esModule","getRealpath","n","realpathSync","e","memoize","Map","memosep","sep","loadNycConfig","cwd","opts","memokey","args","resolve","__dirname","push","nycrcPath","has","get","result","JSON","parse","execFileSync","process","execPath","error","Error","config","defaults","babelPluginIstanbul","set","findConfig","env","NYC_CWD","keys","ignored","filter","s","length","NYC_CONFIG","makeShouldSkip","exclude","shouldSkip","file","nycConfig","include","extension","excludeNodeModules","shouldInstrument","_default","declare","api","assertVersion","t","types","visitor","Program","enter","path","__dv__","realPath","filename","inputSourceMap","useInlineSourceMaps","inputMap","sourcemap","visitorOptions","entries","instrumentVisitor","forEach","name","defaultValue","programVisitor","exit","onCover","fileCoverage"],"mappings":"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","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _path = _interopRequireDefault(require(\"path\"));\n\nvar _fs = require(\"fs\");\n\nvar _child_process = require(\"child_process\");\n\nvar _helperPluginUtils = require(\"@babel/helper-plugin-utils\");\n\nvar _istanbulLibInstrument = require(\"istanbul-lib-instrument\");\n\nvar _testExclude = _interopRequireDefault(require(\"test-exclude\"));\n\nvar _schema = _interopRequireDefault(require(\"@istanbuljs/schema\"));\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction getRealpath(n) {\n  try {\n    return (0, _fs.realpathSync)(n) ||\n    /* istanbul ignore next */\n    n;\n  } catch (e) {\n    /* istanbul ignore next */\n    return n;\n  }\n}\n\nconst memoize = new Map();\n/* istanbul ignore next */\n\nconst memosep = _path.default.sep === '/' ? ':' : ';';\n\nfunction loadNycConfig(cwd, opts) {\n  let memokey = cwd;\n  const args = [_path.default.resolve(__dirname, 'load-nyc-config-sync.js'), cwd];\n\n  if ('nycrcPath' in opts) {\n    args.push(opts.nycrcPath);\n    memokey += memosep + opts.nycrcPath;\n  }\n  /* execFileSync is expensive, avoid it if possible! */\n\n\n  if (memoize.has(memokey)) {\n    return memoize.get(memokey);\n  }\n\n  const result = JSON.parse((0, _child_process.execFileSync)(process.execPath, args));\n  const error = result['load-nyc-config-sync-error'];\n\n  if (error) {\n    throw new Error(error);\n  }\n\n  const config = { ..._schema.default.defaults.babelPluginIstanbul,\n    cwd,\n    ...result\n  };\n  memoize.set(memokey, config);\n  return config;\n}\n\nfunction findConfig(opts) {\n  const cwd = getRealpath(opts.cwd || process.env.NYC_CWD ||\n  /* istanbul ignore next */\n  process.cwd());\n  const keys = Object.keys(opts);\n  const ignored = Object.keys(opts).filter(s => s === 'nycrcPath' || s === 'cwd');\n\n  if (keys.length > ignored.length) {\n    // explicitly configuring options in babel\n    // takes precedence.\n    return { ..._schema.default.defaults.babelPluginIstanbul,\n      cwd,\n      ...opts\n    };\n  }\n\n  if (ignored.length === 0 && process.env.NYC_CONFIG) {\n    // defaults were already applied by nyc\n    return JSON.parse(process.env.NYC_CONFIG);\n  }\n\n  return loadNycConfig(cwd, opts);\n}\n\nfunction makeShouldSkip() {\n  let exclude;\n  return function shouldSkip(file, nycConfig) {\n    if (!exclude || exclude.cwd !== nycConfig.cwd) {\n      exclude = new _testExclude.default({\n        cwd: nycConfig.cwd,\n        include: nycConfig.include,\n        exclude: nycConfig.exclude,\n        extension: nycConfig.extension,\n        // Make sure this is true unless explicitly set to `false`. `undefined` is still `true`.\n        excludeNodeModules: nycConfig.excludeNodeModules !== false\n      });\n    }\n\n    return !exclude.shouldInstrument(file);\n  };\n}\n\nvar _default = (0, _helperPluginUtils.declare)(api => {\n  api.assertVersion(7);\n  const shouldSkip = makeShouldSkip();\n  const t = api.types;\n  return {\n    visitor: {\n      Program: {\n        enter(path) {\n          this.__dv__ = null;\n          this.nycConfig = findConfig(this.opts);\n          const realPath = getRealpath(this.file.opts.filename);\n\n          if (shouldSkip(realPath, this.nycConfig)) {\n            return;\n          }\n\n          let {\n            inputSourceMap\n          } = this.opts;\n\n          if (this.opts.useInlineSourceMaps !== false) {\n            if (!inputSourceMap && this.file.inputMap) {\n              inputSourceMap = this.file.inputMap.sourcemap;\n            }\n          }\n\n          const visitorOptions = {};\n          Object.entries(_schema.default.defaults.instrumentVisitor).forEach(([name, defaultValue]) => {\n            if (name in this.nycConfig) {\n              visitorOptions[name] = this.nycConfig[name];\n            } else {\n              visitorOptions[name] = _schema.default.defaults.instrumentVisitor[name];\n            }\n          });\n          this.__dv__ = (0, _istanbulLibInstrument.programVisitor)(t, realPath, { ...visitorOptions,\n            inputSourceMap\n          });\n\n          this.__dv__.enter(path);\n        },\n\n        exit(path) {\n          if (!this.__dv__) {\n            return;\n          }\n\n          const result = this.__dv__.exit(path);\n\n          if (this.opts.onCover) {\n            this.opts.onCover(getRealpath(this.file.opts.filename), result.fileCoverage);\n          }\n        }\n\n      }\n    }\n  };\n});\n\nexports.default = _default;"]},"metadata":{},"sourceType":"script"}