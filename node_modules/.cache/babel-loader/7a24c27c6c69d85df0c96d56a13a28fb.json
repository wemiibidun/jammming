{"ast":null,"code":"'use strict';\n\nmodule.exports = function (PromiseArgument) {\n  var Promise;\n\n  function throat(size, fn) {\n    var queue = new Queue();\n\n    function run(fn, self, args) {\n      if (size) {\n        size--;\n        var result = new Promise(function (resolve) {\n          resolve(fn.apply(self, args));\n        });\n        result.then(release, release);\n        return result;\n      } else {\n        return new Promise(function (resolve) {\n          queue.push(new Delayed(resolve, fn, self, args));\n        });\n      }\n    }\n\n    function release() {\n      size++;\n\n      if (!queue.isEmpty()) {\n        var next = queue.shift();\n        next.resolve(run(next.fn, next.self, next.args));\n      }\n    }\n\n    if (typeof size === 'function') {\n      var temp = fn;\n      fn = size;\n      size = temp;\n    }\n\n    if (typeof size !== 'number') {\n      throw new TypeError('Expected throat size to be a number but got ' + typeof size);\n    }\n\n    if (fn !== undefined && typeof fn !== 'function') {\n      throw new TypeError('Expected throat fn to be a function but got ' + typeof fn);\n    }\n\n    if (typeof fn === 'function') {\n      return function () {\n        var args = [];\n\n        for (var i = 0; i < arguments.length; i++) {\n          args.push(arguments[i]);\n        }\n\n        return run(fn, this, args);\n      };\n    } else {\n      return function (fn) {\n        if (typeof fn !== 'function') {\n          throw new TypeError('Expected throat fn to be a function but got ' + typeof fn);\n        }\n\n        var args = [];\n\n        for (var i = 1; i < arguments.length; i++) {\n          args.push(arguments[i]);\n        }\n\n        return run(fn, this, args);\n      };\n    }\n  }\n\n  if (arguments.length === 1 && typeof PromiseArgument === 'function') {\n    Promise = PromiseArgument;\n    return throat;\n  } else {\n    Promise = module.exports.Promise;\n\n    if (typeof Promise !== 'function') {\n      throw new Error('You must provide a Promise polyfill for this library to work in older environments');\n    }\n\n    return throat(arguments[0], arguments[1]);\n  }\n};\n\nmodule.exports.default = module.exports;\n/* istanbul ignore next */\n\nif (typeof Promise === 'function') {\n  module.exports.Promise = Promise;\n}\n\nfunction Delayed(resolve, fn, self, args) {\n  this.resolve = resolve;\n  this.fn = fn;\n  this.self = self || null;\n  this.args = args;\n}\n\nfunction Queue() {\n  this._s1 = [];\n  this._s2 = [];\n}\n\nQueue.prototype.push = function (value) {\n  this._s1.push(value);\n};\n\nQueue.prototype.shift = function () {\n  var s2 = this._s2;\n\n  if (s2.length === 0) {\n    var s1 = this._s1;\n\n    if (s1.length === 0) {\n      return;\n    }\n\n    this._s1 = s2;\n    s2 = this._s2 = s1.reverse();\n  }\n\n  return s2.pop();\n};\n\nQueue.prototype.isEmpty = function () {\n  return !this._s1.length && !this._s2.length;\n};","map":{"version":3,"sources":["/Users/wemi/jammming/node_modules/throat/index.js"],"names":["module","exports","PromiseArgument","Promise","throat","size","fn","queue","Queue","run","self","args","result","resolve","apply","then","release","push","Delayed","isEmpty","next","shift","temp","TypeError","undefined","i","arguments","length","Error","default","_s1","_s2","prototype","value","s2","s1","reverse","pop"],"mappings":"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","sourcesContent":["'use strict';\n\nmodule.exports = function (PromiseArgument) {\n  var Promise;\n  function throat(size, fn) {\n    var queue = new Queue();\n    function run(fn, self, args) {\n      if (size) {\n        size--;\n        var result = new Promise(function (resolve) {\n          resolve(fn.apply(self, args));\n        });\n        result.then(release, release);\n        return result;\n      } else {\n        return new Promise(function (resolve) {\n          queue.push(new Delayed(resolve, fn, self, args));\n        });\n      }\n    }\n    function release() {\n      size++;\n      if (!queue.isEmpty()) {\n        var next = queue.shift();\n        next.resolve(run(next.fn, next.self, next.args));\n      }\n    }\n    if (typeof size === 'function') {\n      var temp = fn;\n      fn = size;\n      size = temp;\n    }\n    if (typeof size !== 'number') {\n      throw new TypeError(\n        'Expected throat size to be a number but got ' + typeof size\n      );\n    }\n    if (fn !== undefined && typeof fn !== 'function') {\n      throw new TypeError(\n        'Expected throat fn to be a function but got ' + typeof fn\n      );\n    }\n    if (typeof fn === 'function') {\n      return function () {\n        var args = [];\n        for (var i = 0; i < arguments.length; i++) {\n          args.push(arguments[i]);\n        }\n        return run(fn, this, args);\n      };\n    } else {\n      return function (fn) {\n        if (typeof fn !== 'function') {\n          throw new TypeError(\n            'Expected throat fn to be a function but got ' + typeof fn\n          );\n        }\n        var args = [];\n        for (var i = 1; i < arguments.length; i++) {\n          args.push(arguments[i]);\n        }\n        return run(fn, this, args);\n      };\n    }\n  }\n  if (arguments.length === 1 && typeof PromiseArgument === 'function') {\n    Promise = PromiseArgument;\n    return throat;\n  } else {\n    Promise = module.exports.Promise;\n    if (typeof Promise !== 'function') {\n      throw new Error(\n        'You must provide a Promise polyfill for this library to work in older environments'\n      );\n    }\n    return throat(arguments[0], arguments[1]);\n  }\n};\n\nmodule.exports.default = module.exports;\n\n/* istanbul ignore next */\nif (typeof Promise === 'function') {\n  module.exports.Promise = Promise;\n}\n\nfunction Delayed(resolve, fn, self, args) {\n  this.resolve = resolve;\n  this.fn = fn;\n  this.self = self || null;\n  this.args = args;\n}\n\nfunction Queue() {\n  this._s1 = [];\n  this._s2 = [];\n}\n\nQueue.prototype.push = function (value) {\n  this._s1.push(value);\n};\n\nQueue.prototype.shift = function () {\n  var s2 = this._s2;\n  if (s2.length === 0) {\n    var s1 = this._s1;\n    if (s1.length === 0) {\n      return;\n    }\n    this._s1 = s2;\n    s2 = this._s2 = s1.reverse();\n  }\n  return s2.pop();\n};\n\nQueue.prototype.isEmpty = function () {\n  return !this._s1.length && !this._s2.length;\n};\n"]},"metadata":{},"sourceType":"script"}